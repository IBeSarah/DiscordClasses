- name: Create GitHub commit comment (chunked)
  uses: actions/github-script@v6
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    script: |
      const fs = require('fs');
      const MAX_COMMENT_LENGTH = 65536;

      const diffText = fs.readFileSync('current_diff.txt', 'utf8');
      if(!diffText.trim()) return;

      // Split text into chunks
      const chunks = [];
      let start = 0;
      while(start < diffText.length){
        chunks.push(diffText.slice(start, start + MAX_COMMENT_LENGTH));
        start += MAX_COMMENT_LENGTH;
      }

      // Post each chunk as a separate comment
      for(let i = 0; i < chunks.length; i++){
        const partHeader = chunks.length > 1 ? `**Part ${i+1} of ${chunks.length}**\n\n` : '';
        await github.rest.repos.createCommitComment({
          owner: context.repo.owner,
          repo: context.repo.repo,
          commit_sha: context.sha,
          body: partHeader + chunks[i]
        });
      }
